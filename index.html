<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dad Jokes</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .joke {
            font-size: 1.3em;
            line-height: 1.6;
            color: #555;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            margin: 20px 0;
        }

        .setup {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .punchline {
            font-style: italic;
            color: #764ba2;
        }

        .joke-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .navigation {
            margin-top: 30px;
        }

        .nav-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .date-display {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .loading {
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ Dad Jokes Daily</h1>
        <div class="date-display" id="date-display">Loading...</div>

        <img id="joke-image" class="joke-image" style="display: none;" alt="Joke illustration">

        <div class="joke">
            <div class="setup" id="joke-content">Loading your daily dad joke...</div>
        </div>

        <div class="navigation">
            <button class="nav-btn" id="prev-btn">‚Üê Previous Day</button>
            <button class="nav-btn" id="next-btn">Next Day ‚Üí</button>
        </div>
    </div>

    <script>
        class DadJokeApp {
            constructor() {
                this.jokeContent = document.getElementById('joke-content');
                this.jokeImage = document.getElementById('joke-image');
                this.dateDisplay = document.getElementById('date-display');
                this.prevBtn = document.getElementById('prev-btn');
                this.nextBtn = document.getElementById('next-btn');

                this.currentDayOffset = 0; // 0 = today, 1 = yesterday, etc.
                this.dailyJokes = null;

                this.init();
            }

            init() {
                this.prevBtn.addEventListener('click', () => this.previousDay());
                this.nextBtn.addEventListener('click', () => this.nextDay());
                this.loadDailyJokes();
            }

            async loadDailyJokes() {
                try {
                    const response = await fetch('/api/daily-jokes');
                    this.dailyJokes = await response.json();
                    this.loadTodaysJoke();
                } catch (error) {
                    console.error('Error loading jokes:', error);
                    // Fallback to hardcoded joke
                    this.dailyJokes = {
                        jokes: [{
                            date: new Date().toISOString().split('T')[0],
                            joke: "Why don't scientists trust atoms? Because they make up everything!",
                            image: "",
                            category: "science"
                        }]
                    };
                    this.loadTodaysJoke();
                }
            }

            loadTodaysJoke() {
                const today = new Date();
                const targetDate = new Date(today);
                targetDate.setDate(targetDate.getDate() - this.currentDayOffset);

                const dateString = targetDate.toISOString().split('T')[0];
                const todayJoke = this.dailyJokes.jokes.find(joke => joke.date === dateString);

                if (todayJoke) {
                    this.displayJoke(todayJoke, targetDate);
                } else {
                    // Fallback to first available joke
                    const fallbackJoke = this.dailyJokes.jokes[0];
                    if (fallbackJoke) {
                        this.displayJoke(fallbackJoke, new Date(fallbackJoke.date));
                    }
                }
            }

            displayJoke(joke, date) {
                // Format date nicely
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                };
                this.dateDisplay.textContent = date.toLocaleDateString('en-US', options);

                // Display joke
                this.jokeContent.textContent = joke.joke;

                // Display image if available
                if (joke.image && !joke.image.includes('placeholder')) {
                    this.jokeImage.src = joke.image;
                    this.jokeImage.style.display = 'block';
                } else {
                    this.jokeImage.style.display = 'none';
                }

                // Update navigation buttons
                this.updateNavigationButtons();
            }

            previousDay() {
                this.currentDayOffset++;
                this.loadTodaysJoke();
            }

            nextDay() {
                if (this.currentDayOffset > 0) {
                    this.currentDayOffset--;
                    this.loadTodaysJoke();
                }
            }

            updateNavigationButtons() {
                // Disable next button if we're at today
                this.nextBtn.disabled = this.currentDayOffset === 0;
                this.nextBtn.style.opacity = this.currentDayOffset === 0 ? '0.5' : '1';
            }
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new DadJokeApp();
        });
    </script>
</body>
</html>